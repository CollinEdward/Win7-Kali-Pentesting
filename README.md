# Setting Up a Penetration Testing Lab with Kali Linux and Windows 7 in VirtualBox

## Introduction

Penetration testing, often referred to as “ethical hacking,” is a process used to evaluate the security of computer systems by simulating attacks to identify vulnerabilities. This guide will walk you through the setup of a penetration testing environment using **Kali Linux** and **Windows 7** virtual machines (VMs) in **VirtualBox**.

> **Note:** Penetration testing should **only** be performed on systems that you have explicit permission to test. Unauthorized testing is illegal and unethical.

### Why Use Virtual Machines for Penetration Testing?
- **Isolated Environment:** Allows for testing and experimentation without affecting the host system.
- **Convenience:** Multiple OS environments can be set up on a single physical machine.
- **Snapshots and Rollbacks:** Easy recovery if something goes wrong.

### Prerequisites
- A host system capable of running VirtualBox.
- At least 8 GB of RAM and 40 GB of disk space.
- Familiarity with basic Linux commands and networking concepts.

---

## Step 1: Download Required Software

### 1.1 Kali Linux
- Visit the [Kali Linux Downloads Page](https://www.kali.org/downloads/).
- Download the pre-configured VirtualBox VM image (.ova format) or the ISO file for manual installation.
- Choose the version that suits your needs (e.g., standard, light, or headless).

### 1.2 Windows 7
- Go to the [Internet Archive Windows 7 ISO](https://archive.org/details/Windows7-iso).
- Select and download the Windows 7 ISO file. Ensure you choose the 64-bit version if your host system supports it.

### 1.3 VirtualBox
- Access [VirtualBox Downloads](https://www.virtualbox.org/wiki/Downloads).
- Download and install the latest version of VirtualBox and the **Extension Pack** to enable additional features (e.g., USB 2.0/3.0 support).

---

## Step 2: Install VirtualBox

1. Launch the downloaded VirtualBox installer.
2. Follow the on-screen instructions:
   - Choose installation location and components.
   - Enable network interfaces (VirtualBox may briefly disconnect your network during installation).
3. Once installed, open VirtualBox and ensure it’s functioning correctly.

---

## Step 3: Create Virtual Machines

### 3.1 Creating a Kali Linux VM
1. In VirtualBox, click **New**.
2. Set up the VM with the following configuration:
   - **Name:** Kali Linux
   - **Type:** Linux
   - **Version:** Debian (64-bit)
   - **Memory:** Allocate 2-4 GB (2048-4096 MB).
   - **Hard Disk:** Select **Use an existing virtual hard disk file** and browse to the Kali Linux `.vmdk` file (if using a pre-made image) or create a new dynamically allocated disk of at least 20 GB.
3. Save and close the VM settings.

### 3.2 Creating a Windows 7 VM
1. Click **New** again to create a second VM.
2. Set up the VM with the following configuration:
   - **Name:** Windows 7
   - **Type:** Microsoft Windows
   - **Version:** Windows 7 (64-bit)
   - **Memory:** Allocate 2-4 GB (2048-4096 MB).
   - **Hard Disk:** Create a new dynamically allocated disk of at least 30 GB.
3. In **Storage**, add the Windows 7 ISO file as a boot disk.
4. Save and close the VM settings.

---

## Step 4: Configuring Network Settings

### 4.1 Configuring Kali Linux VM Network
1. Open **Settings** for the Kali Linux VM.
2. Go to the **Network** tab:
   - **Adapter 1:** Enable and choose the network mode:
     - **NAT:** Allows the VM to access the internet through the host’s IP.
     - **Bridged Adapter:** Gives the VM a unique IP on the local network, making it directly accessible to other machines.
     - **Host-only Adapter:** Isolates the VM from external networks, allowing communication only with the host.
   - **Adapter 2 (Optional):** Add another network interface if required for testing multiple network scenarios.
3. Click **OK** to save changes.

### 4.2 Configuring Windows 7 VM Network
1. Open **Settings** for the Windows 7 VM.
2. Go to the **Network** tab:
   - **Adapter 1:** Enable and select the same network mode as used for Kali Linux.
3. Save changes.

> **Tip:** Use the **Host-only Adapter** mode to establish a private network for testing between Kali Linux and Windows 7. This setup ensures the VMs can communicate while being isolated from external networks.

---

## Step 5: Installing Operating Systems

### 5.1 Installing Kali Linux
1. Select the Kali Linux VM and click **Start**.
2. If using a pre-configured `.ova` file, Kali will boot up without additional configuration.
3. If using an ISO file, follow the installation steps:
   - Choose the installation method (Graphical or Text-based).
   - Configure user, password, and partitions.
   - Complete the installation and reboot.

### 5.2 Installing Windows 7
1. Select the Windows 7 VM and click **Start**.
2. Follow the Windows 7 installation wizard:
   - Choose language and region settings.
   - Enter the product key (if required).
   - Configure initial user and settings.
3. Complete the installation and reboot.

---

## Step 6: Configuring for Penetration Testing

### 6.1 Identifying Target IP Address
1. In the Windows 7 VM, open **Command Prompt** (`cmd.exe`).
2. Type `ipconfig` and press Enter.
3. Note down the IP address assigned to the VM under **IPv4 Address**. This will be the `LHOST` used for targeting during testing.

### 6.2 Scanning for Vulnerabilities with Kali Linux
Open a terminal in Kali Linux and use the following commands:

1. **Port Scanning:**
   ```bash
   nmap -p- <LHOST>
   ```
   - Scans all 65,535 TCP ports on the target machine.

2. **Service and Version Enumeration:**
   ```bash
   nmap -sV <LHOST>
   ```
   - Identifies running services and versions.

3. **Operating System Detection:**
   ```bash
   nmap -O <LHOST>
   ```
   - Detects the operating system based on response characteristics.

4. **Vulnerability Scanning:**
   ```bash
   nmap --script vuln <LHOST>
   ```
   - Scans for known vulnerabilities using Nmap’s built-in scripts.

5. **Comprehensive Scanning:**
   ```bash
   nmap -p- -sV -O --script vuln <LHOST>
   ```
   - Combines port scanning, service/version detection, OS identification, and vulnerability scanning in a single command.

### 6.3 Analyzing Scan Results
- Review the output for open ports, services, and identified vulnerabilities.
- Note any critical vulnerabilities and research their impact.

### 6.4 Exploiting Vulnerabilities
1. Use tools like **Metasploit** for exploiting discovered vulnerabilities:
   - Launch Metasploit (`msfconsole`).
   - Search and use exploits relevant to the vulnerabilities found (`search <vulnerability>`).
   - Configure the payload and target settings.
   - Run the exploit and gain access.

> **Important:** Always ensure you have explicit authorization before exploiting any vulnerabilities.

---

## Troubleshooting and Best Practices

### VM Not Starting
- Check if your host system meets hardware requirements.
- Ensure virtualization is enabled in BIOS/UEFI settings.
- Reconfigure memory or CPU allocation if the VM fails to boot.

### Network Connectivity Issues
- Verify network adapter settings and modes (NAT, Bridged, Host-only).
- Check firewall and security settings on the host and VM.
- Restart VirtualBox or reinitialize network adapters if necessary.

### Compatibility and Performance
- Use compatible VirtualBox and Extension Pack versions.
- Allocate sufficient resources to each VM.
- Keep guest additions updated for better performance.

---

## Conclusion
You have successfully set up a penetration testing lab using Kali Linux and Windows 7 in VirtualBox. This environment will allow you to practice ethical hacking, network scanning, vulnerability analysis, and exploit development. Always conduct penetration testing responsibly, with explicit permission, and adhere to ethical guidelines.

### Further Learning
- [Kali Linux Official Documentation](https://www.kali.org/docs/)
- [VirtualBox Manual](https://www.virtualbox.org/manual/)
- [Nmap Network Scanning Guide](https://nmap.org/book/)
- [Metasploit Unleashed](https://www.offensive-security.com/metasploit-unleashed/)
